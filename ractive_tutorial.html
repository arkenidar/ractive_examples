<!doctype html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>to-do list</title>

<div id="target"></div>

<script id="template" type="text/ractive">
  <h3>to-do list</h3>
  <button onclick="toggle_edit_mode()">toggle edit-mode</button>
  {{#if edit_mode==true}}
    <ul>
      {{#each todos: index}}
      <li>
        {{#if editing!=index}}
          {{#if reorder_mode}}
            <button onclick="up({{index}})">up</button>
            <button onclick="down({{index}})">down</button>
            {{this}}
          {{else}}
            <button onclick="edit({{index}})">{{this}}</button>
          {{/if}}
        {{else}}
          <form onsubmit="save({{index}}); return false;">
          <input value="{{item_edit}}" id="item_edit" autocomplete="off">
          <button type="submit">save</button>
          <button type="button" onclick="remove({{index}})">remove</button>
          </form>
        {{/if}}
        </li>
      {{/each}}
      <li>
        <form onsubmit="add(); return false;">
          <input value='{{item}}' id="item_add" autocomplete="off"> <button type="submit">add</button>
        </form>
      </li>
    </ul>
    <button onclick="toggle_reorder_mode()">toggle reorder-mode</button>
  {{else}}
    <ul>
      {{#each todos}}
        <li>{{this}}</li>
      {{/each}}
    </ul>
  {{/if}}

</script>

<script src="https://cdn.jsdelivr.net/npm/ractive"></script>

<script>
var ractive = new Ractive({

  target: '#target',

  template: '#template',

  data: {

    todos: ['gym ...','games ...', 'walk ...', 'talk ...', 'visit ...', 'check ...'],

    editing: -1,
    edit_mode: false,
    reorder_mode: false,
  },

})

function add(){
  var item = ractive.get('item')
  if(item.trim()=='') return
  var todos = ractive.get('todos')
  todos.push(item)
  ractive.set('todos', todos)
  ractive.set('item', '')
}

function remove(item){
  ractive.set('editing', -1)
  var todos = ractive.get('todos')
  todos.splice(item, 1)
  ractive.set('todos', todos)
}

function edit(index){
  ractive.set('item_edit', ractive.get('todos')[index])
  ractive.set('editing', index)
}

function save(index){
  ractive.set('editing', -1)
  var item_edit = ractive.get('item_edit')
  if(item_edit.trim()==''){
    remove(index)
    return
  }
  var todos = ractive.get('todos')
  todos[index] = item_edit
  ractive.set('todos', todos)
}

function swap(array, index_a, index_b){
  var temp = array[index_a]
  array[index_a] = array[index_b]
  array[index_b] = temp
  return array
}

function up(index){
  var todos = ractive.get('todos')
  if(index<=0) return
  ractive.set('todos', swap(todos, index, index-1))
}

function down(index){
  var todos = ractive.get('todos')
  if(index>=(todos.length-1)) return
  ractive.set('todos', swap(todos, index, index+1))
}

function toggle_edit_mode(){
  ractive.set('reorder_mode', false)
  ractive.set('edit_mode', !ractive.get('edit_mode'))
}

function toggle_reorder_mode(){
  ractive.set('reorder_mode', !ractive.get('reorder_mode'))
}

</script>
