<!doctype html>
<body>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>eval js</title>

<script>
function evalElement(element, remove=false){
    if(remove) element.parentNode.removeChild(element.nextSibling)
    var eval_result=eval(element.innerText)
    var html_result=typeof eval_result!='function'?eval_result:eval_result(element)
    if(typeof html_result != 'undefined') outHTML(element, html_result)
    function outHTML(element, html_result){
        element.insertAdjacentHTML('afterend','<span>'+html_result+'</span>')
    }
}

document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll('script[evalwrite]').forEach((element)=>evalElement(element)) 
    document.querySelectorAll('script[evalwrite=repeatdly]').forEach(element=>setInterval(()=>evalElement(element,true)))
})

const fetchUT = async (url,type='json') => await (await fetch(url))[type]()

var array=[]
function ulFromArray(array){
    var html='<ul>'
    for(var i of array.keys())
        html+='<li>'+array[i]+'</li>'
    html+='</ul>'
    return html
}
var counter=1
</script>

<!-- live date -->
<div><script evalwrite="repeatdly">new Date()</script></div>

<!-- evalAsync with fetch -->
<div><script evalwrite="once">
((element)=>{
fetchUT('sample_text.txt','text').then((data)=>{
    //data=JSON.stringify(data)
    outHTML(element, data)
})
})
</script></div>

<!-- value from input -->
<div><input id="name" placeholder="name" value="World"> Hello <script evalwrite="repeatdly">document.all.name.value</script></div>

<!-- value from input modified for "two-way data binding" -->
<div>
    <input id="name2" placeholder="name" value="World" oninput="window.name2=this.value">
    Hello <script evalwrite="repeatdly">name2</script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        //document.all.name2.dispatchEvent(new Event('input'))

        // input fired in a generalized style (id not specified)
        document.querySelectorAll('input[value]').forEach((input)=>{input.dispatchEvent(new Event('input'))})
    })
    </script>
</div>

<a onclick="option(1)">option1</a> <a onclick="option(2)">option2</a> <a onclick="option(3)">option3</a>
<script>function option(n){
document.querySelectorAll('.option').forEach(option=>option.style.display='none')
document.querySelector('#option'+parseInt(n)).style.display='block'
}</script>
<div class="option" id="option1"><script evalwrite="once">ulFromArray([10,20,30])</script></div>
<div class="option" id="option2"><script evalwrite="once">ulFromArray(['aaa','bbb','ccc'])</script></div>
<div class="option" id="option3">option3...</div>

<script evalwrite="repeatdly">ulFromArray(array)</script>
<button onclick="array=[1,2,3]">set [1,2,3]</button>
<button onclick="array=[3,4,5]">set [3,4,5]</button>

<!-- evalAsync with fetch + rendered JSON -->
<div><script evalwrite="once">
((element)=>{
fetchUT('sample_json.json','json').then((json)=>{
    outHTML(element, ulFromArray(json))
})
})
</script></div>

<!-- password reveal example -->
<div>
    <input type="password" id="password"><input type="checkbox" id="showPassword">
    <script evalwrite="repeatdly">document.getElementById('showPassword').checked?document.getElementById('password').value:''</script>
</div>

<div><button onclick="counter++">+</button><script evalwrite="repeatdly">counter</script></div>
<div><button onclick="counter++;evalElement(document.all.tew,true)"">+</button><script evalwrite="triggered" id="tew">counter</script></div>

</body>
